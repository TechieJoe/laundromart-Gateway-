<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Laundry Order</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
    }

    h1 {
      text-align: center;
      color: #333;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      margin: 20px auto;
    }

    th, td {
      padding: 12px 15px;
      text-align: center;
      border-bottom: 1px solid #ddd;
    }

    th {
      background-color: #007bff;
      color: white;
      font-size: 14px;
    }

    .btn, .decrement, .increment {
      padding: 6px 12px;
      font-size: 14px;
      border: none;
      cursor: pointer;
      border-radius: 5px;
      background-color: #007bff;
      color: white;
    }

    .decrement, .increment {
      background-color: #6c757d;
    }

    .btn:hover {
      background-color: #0056b3;
    }

    #submit {
      background-color: #28a745;
      margin: 20px auto;
      display: block;
    }

    #submit:hover {
      background-color: #218838;
    }

    .value {
      padding: 5px 10px;
      border: 1px solid #ccc;
      min-width: 30px;
      display: inline-block;
      background: #f1f1f1;
    }
  </style>
</head>
<body>
  <%- include('navBar') %>
  <h1>Select Services</h1>

  <table id="serviceTable">
    <tr>
      <th>Item</th>
      <th>Wash</th>
      <th>Iron</th>
      <th>Quantity</th>
    </tr>

    <!-- Example row -->
    <tr>
      <td>Shirt <input type="checkbox" class="item"></td>
      <td>200 <input type="checkbox" class="optional" data-action="wash" data-price="200"></td>
      <td>200 <input type="checkbox" class="optional" data-action="iron" data-price="200"></td>
      <td>
        <button class="decrement">-</button>
        <span class="value">0</span>
        <button class="increment">+</button>
      </td>
    </tr>
            <tr>
            <td>Plain Trouser <input type="checkbox" class="item"></td>
            <td>150 <input type="checkbox" class="optional" data-action="wash" data-price="150"></td>
            <td>150 <input type="checkbox" class="optional" data-action="iron" data-price="150"></td>
            <td>
                <button class="btn decrement">-</button>
                <span class="value">0</span>
                <button class="btn increment">+</button>
            </td>
        </tr>
        <tr>
            <td>Polo <input type="checkbox" class="item"></td>
            <td>150 <input type="checkbox" class="optional" data-action="wash" data-price="150"></td>
            <td>150 <input type="checkbox" class="optional" data-action="iron" data-price="150"></td>
            <td>
                <button class="btn decrement">-</button>
                <span class="value">0</span>
                <button class="btn increment">+</button>
            </td>
        </tr>
        <tr>
            <td>Jean Trouser <input type="checkbox" class="item"></td>
            <td>200 <input type="checkbox" class="optional" data-action="wash" data-price="200"></td>
            <td>200 <input type="checkbox" class="optional" data-action="iron" data-price="200"></td>
            <td>
                <button class="btn decrement">-</button>
                <span class="value">0</span>
                <button class="btn increment">+</button>
            </td>
        </tr>
        <tr>
            <td>Suit <input type="checkbox" class="item"></td>
            <td>400 <input type="checkbox" class="optional" data-action="wash" data-price="400"></td>
            <td>400 <input type="checkbox" class="optional" data-action="iron" data-price="400"></td>
            <td>
                <button class="btn decrement">-</button>
                <span class="value">0</span>
                <button class="btn increment">+</button>
            </td>
        </tr>
        <tr>
            <td>Short <input type="checkbox" class="item"></td>
            <td>150 <input type="checkbox" class="optional" data-action="wash" data-price="150"></td>
            <td>150 <input type="checkbox" class="optional" data-action="iron" data-price="150"></td>
            <td>
                <button class="btn decrement">-</button>
                <span class="value">0</span>
                <button class="btn increment">+</button>
            </td>
        </tr>
        <tr>
            <td>Pygamas <input type="checkbox" class="item"></td>
            <td>300 <input type="checkbox" class="optional" data-action="wash" data-price="300"></td>
            <td>300 <input type="checkbox" class="optional" data-action="iron" data-price="300"></td>
            <td>
                <button class="btn decrement">-</button>
                <span class="value">0</span>
                <button class="btn increment">+</button>
            </td>
        </tr>
        <tr>
            <td>Hoodies <input type="checkbox" class="item"></td>
            <td>300 <input type="checkbox" class="optional" data-action="wash" data-price="300"></td>
            <td>800 <input type="checkbox" class="optional" data-action="iron" data-price="800"></td>
            <td>
                <button class="btn decrement">-</button>
                <span class="value">0</span>
                <button class="btn increment">+</button>
            </td>
        </tr>
        <tr>
            <td>Singlet <input type="checkbox" class="item"></td>
            <td>200 <input type="checkbox" class="optional" data-action="wash" data-price="200"></td>
            <td>100 <input type="checkbox" class="optional" data-action="iron" data-price="100"></td>
            <td>
                <button class="btn decrement">-</button>
                <span class="value">0</span>
                <button class="btn increment">+</button>
            </td>
        </tr>
        <tr>
            <td>Towel <input type="checkbox" class="item"></td>
            <td>1000 <input type="checkbox" class="optional" data-action="wash" data-price="1000"></td>
            <td>900 <input type="checkbox" class="optional" data-action="iron" data-price="900"></td>
            <td>
                <button class="btn decrement">-</button>
                <span class="value">0</span>
                <button class="btn increment">+</button>
            </td>
        </tr>
        <tr>
            <td>Bed Cover <input type="checkbox" class="item"></td>
            <td>1000 <input type="checkbox" class="optional" data-action="wash" data-price="1000"></td>
            <td>300 <input type="checkbox" class="optional" data-action="iron" data-price="300"></td>
            <td>
                <button class="btn decrement">-</button>
                <span class="value">0</span>
                <button class="btn increment">+</button>
            </td>
        </tr>

  </table>

  <button id="submit" class="btn">Submit</button>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const table = document.getElementById('serviceTable');
      const submitBtn = document.getElementById('submit');

      // Quantity buttons
      table.addEventListener('click', (e) => {
        if (e.target.classList.contains('increment') || e.target.classList.contains('decrement')) {
          const valueElem = e.target.closest('td').querySelector('.value');
          let current = parseInt(valueElem.textContent) || 0;

          if (e.target.classList.contains('increment')) {
            valueElem.textContent = current + 1;
          } else if (e.target.classList.contains('decrement')) {
            valueElem.textContent = Math.max(0, current - 1);
          }
        }
      });

// Submit order
submitBtn.addEventListener('click', () => {
  const rows = table.querySelectorAll('tr');
  const orders = [];
  let grandTotal = 0;

  rows.forEach((row, index) => {
    if (index === 0) return; // Skip header

    const itemCheckbox = row.querySelector('.item');
    const optionalCheckboxes = row.querySelectorAll('.optional');
    const quantity = parseInt(row.querySelector('.value')?.textContent) || 0;
    const itemName = row.querySelector('td').textContent.trim().split(' ')[0];

    if (itemCheckbox && itemCheckbox.checked && quantity > 0) {
      const actions = [];
      let itemTotal = 0;

      optionalCheckboxes.forEach(box => {
        if (box.checked) {
          const action = box.dataset.action;
          const price = parseInt(box.dataset.price);
          actions.push({ type: action, price });
          itemTotal += price * quantity;
        }
      });

      if (actions.length > 0) {
        orders.push({
          item: itemName,
          action: actions,
          quantity,
          total: itemTotal
        });
        grandTotal += itemTotal;
      }
    }
  });

  if (orders.length === 0) {
    alert('Please select an item');
    return;
  }

  const orderData = {
    orderId: `ORDER-${Date.now()}`,
    reference: `REF-${Date.now()}`,
    orders,
    grandTotal,
    metadata: {
      source: 'WebApp',
      userAgent: navigator.userAgent
    },
    status: 'pending'
  };

  sessionStorage.setItem('laundry-order', JSON.stringify(orderData));
  window.location.href = '/laundromart/order/create';
});
    });
  </script>
</body>
</html>
